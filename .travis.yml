# Build matrix / environment variable are explained on:
# http://about.travis-ci.org/docs/user/build-configuration/

language: cpp

compiler:
  - gcc
  - clang

os:
  - linux
  - osx

# enable using trusty beta ubuntu
sudo: required
dist: trusty

# install build requirements
before_install:  
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then 
      sudo apt-get update -qq;
      sudo apt-get install -y libsdl2-dev;
      sudo apt-get install -y libglew-dev;
      export DISPLAY=:99.0;
      sh -e /etc/init.d/xvfb start;
      sleep 3;
    fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then 
      brew update;
      brew tap homebrew/versions;
      brew upgrade homebrew/versions/cmake31;
      brew install sdl2;
      brew install glew;
    fi

before_script:
  - cd build
  - cmake -Dbuild_test=ON ..

env:
  - MAKE_TARGET=install
  - MAKE_TARGET=test

script: 
  - make
  - make $MAKE_TARGET
  - if [ "$MAKE_TARGET" == "install" ]; then
      cd ..; 
      ./myapp -y;
    fi