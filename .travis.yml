# Build matrix / environment variable are explained on:
# http://about.travis-ci.org/docs/user/build-configuration/

language: cpp

compiler:
  - gcc
  - clang

os:
  - linux
  - osx

# enable using trusty beta ubuntu
sudo: required
dist: trusty
  
before_install:  
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then sudo apt-get update -qq; fi  
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then sudo apt-get install -y libsdl2-dev; fi  
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then sudo apt-get install -y libglew-dev; fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then brew upgrade cmake; fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then brew install sdl2; fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then brew install glew; fi  
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then export DISPLAY=:99.0; fi
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then sh -e /etc/init.d/xvfb start; fi
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then sleep 3; fi
  
before_script:
  - cd build
  - cmake -Dbuild_test=ON ..

env:
  - MAKE_TARGET=install
  - MAKE_TARGET=test
  
script: 
  - make
  - make $MAKE_TARGET
  - if [ "$MAKE_TARGET" == "install" ]; then cd ..; fi	
  - if [ "$MAKE_TARGET" == "install" ]; then ./myapp -y; fi
